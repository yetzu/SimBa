# 模型架构说明

为解决雷达外推降水场景中（高维稀疏长时空序列预测），当前 `MetMamba` 模型被设计为一个物理信息驱动的确定性骨干网络。它借鉴了 SimVP 经典的 Encoder-MidNet-Decoder 结构以确保高维数据有效压缩与层次化特征提取，同时创新性地在核心计算单元中引入 NowcastingNet 的物理可解性设计，从而实现了从传统黑盒拟合向显式平流与隐式演化协同推理的范式转变；这种物理机制与深度计算的融合，不仅赋予了模型处理强对流平流输送与热力演化等复杂气象动力学的能力，更在应对雷达回波数据的空间稀疏性与长时序非线性依赖时，展现出比传统纯数据驱动模型更为优越的物理一致性与鲁棒性。

---

## 物理视角(理论框架)

将短时强降水（雷达回波演变）视为流体力学中的物理守恒过程，而非单纯的像素预测问题。模型旨在求解 随机平流-扩散-反应方程 (SADRE)：

$$\frac{\partial I}{\partial t} = \underbrace{-\mathbf{v} \cdot \nabla I}_{\text{Advection (平流)}} + \underbrace{\nabla \cdot (D \nabla I)}_{\text{Diffusion (扩散)}} + \underbrace{R(I, \mathbf{Env})}_{\text{Reaction (生消)}} + \underbrace{\mathcal{E}}_{\text{Stochasticity (随机项)}}$$

该方程用于定义短时强降水的物理本质（雷达回波的演变）：
$\frac{\partial I}{\partial t}$：表示强度 $I$（如雷达回波强度）随时间的变化率。

**Advection (平流项) $-\mathbf{v} \cdot \nabla I$**：描述物理守恒的基础，即云团随风移动的惯性。这一项由 AdvectiveProjection（光流分支）建模。

**Diffusion (扩散项) $\nabla \cdot (D \nabla I)$**：描述物质的扩散现象。

**Reaction (生消项) $R(I, \mathbf{Env})$**：描述非线性的生长与消散过程（如对流触发、合并）。扩散与反应项均由 STMamba（时空状态空间模型）建模。

**Stochasticity (随机项) $\mathcal{E}$**：描述大气混沌系统中的不确定性。

---

## 数学视角(数学本质与算子映射)

模型将上述偏微分方程 (PDE) 的各项映射为深度神经网络中的特定算子，本质上是一个 PDE 的神经求解器。

**A.平流项的数学求解：半拉格朗日法 (Semi-Lagrangian Scheme)**

**数学形式**：平流方程 $\frac{\partial I}{\partial t} + \mathbf{v} \cdot \nabla I = 0$ 的特征线解法表明，当前时刻 $t$ 位置 $x$ 的值等于上一时刻 $t-\Delta t$ 位置 $x - \mathbf{v}\Delta t$ 的值。即 $I(x, t) = I(x - \mathbf{v}\Delta t, t-\Delta t)$。

**深度学习映射**：模型不通过卷积去“学习”移动，而是显式地通过坐标变换（Warping）来求解。首先估计速度场 $\mathbf{v}$（光流）。然后执行网格采样（Grid Sample）操作，将特征图沿速度场逆向偏移。

**B.扩散与反应项的求解：状态空间模型 (State Space Models, SSM)**

**数学形式**：扩散与反应项描述了状态随时间的演化 $h'(t)$ 以及空间上的相互作用。这与连续时间的状态空间方程 $h'(t) = \mathbf{A}h(t) + \mathbf{B}x(t)$ 在数学形式上高度同构。

**深度学习映射**：利用 Mamba (Selective SSM) 架构。空间算子 (Spatial Mamba)：模拟扩散项 ($\nabla \cdot (D \nabla I)$)。Mamba 的全局感受野允许信息在空间网格上快速传播，类似于热传导方程中的拉普拉斯算子作用。时间算子 (Temporal Mamba)：模拟 反应项 ($R(I)$)。在时间维度上建模隐状态的非线性演变，捕捉云团的生消周期。

